<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="onePageStyle.css">
  <title>Uni Search</title>
</head>

<body>
  <div id="wholeHTML">
    <div class="header sticky">
      <header>Uni Search</header>
    </div>

    <div class="container">
      <div class="form-container">
        <h1>Find Your Dream University </h1>
        <!-- <form action="onePage.html" onsubmit="processForm(category2course)" id="filter_form_id"> -->
        <form action="" onsubmit="processForm(category2course)" id="filter_form_id">
          <div class="filter_form">
            <div class="formUpperPart">
              <!-- <div class="title">Select all the options below to filter</div> -->
              <div class="divcategory">
                <label for="categories" class="cateTitle">Category</label>
                <input type="text" list="categoriesList" id="categories" name="categories"
                  onchange="displayCourses(category2course)" required>

                <datalist id="categoriesList">
                  <!-- wait for Js -->
                </datalist>
              </div>

              <div class="divcourse">
                <label for="courses" class="courseTitle">Course</label>
                <input type="text" list="coursesList" id="courses" name="courses" required>

                <datalist id="coursesList">
                  <!-- wait for Js -->
                </datalist>
              </div>

              <div class="divcgpa">
                <label for="min_cgpa" class="cgpaTitle">Minimum CGPA</label>
                <input type="text" list="cgpaList" id="cgpa" name="cgpa" required>

                <datalist id="cgpaList">
                  <!-- <option value="0.5"></option> -->
                  <!-- <option value="1.0"></option> -->
                  <!-- <option value="1.5"></option> -->
                  <option value="2.0"></option>
                  <option value="2.5"></option>
                  <option value="3.0"></option>
                  <option value="3.5"></option>
                  <option value="4.0"></option>
                </datalist>
              </div>

              <div class="divmuet">
                <label for="min_muet" class="muetTitle">Minimum Muet Band</label>
                <input type="text" list="muetList" id="muet" name="muet" required>

                <datalist id="muetList">
                  <option value="Band 1"></option>
                  <option value="Band 2"></option>
                  <option value="Band 3"></option>
                  <option value="Band 4"></option>
                  <option value="Band 5"></option>
                  <option value="Band 6"></option>
                </datalist>
              </div>
            </div>

            <p class="locationTitle">Location(s)</p>
            <div class="outerdivlocation">
              <div class="divlocation">
                <div class="location">
                  <label for="Selangor">Selangor</label>
                  <input type="checkbox" name="location" id="Selangor" value="Selangor">
                </div>
                <div class="location">
                  <label for="Perak">Perak</label>
                  <input type="checkbox" name="location" id="Perak" value="Perak">
                </div>
                <div class="location">
                  <label for="Johor">Johor</label>
                  <input type="checkbox" name="location" id="Johor" value="Johor">
                </div>
                <div class="location">
                  <label for="Kedah">Kedah</label>
                  <input type="checkbox" name="location" id="Kedah" value="Kedah">
                </div>
                <div class="location">
                  <label for="Melaka">Melaka</label>
                  <input type="checkbox" name="location" id="Melaka" value="Melaka">
                </div>
                <div class="location">
                  <label for="Kelantan">Kelantan</label>
                  <input type="checkbox" name="location" id="Kelantan" value="Kelantan">
                </div>

                <div class="location">
                  <label for="Penang">Penang</label>
                  <input type="checkbox" name="location" id="Penang" value="Penang">
                </div>

                <div class="location">
                  <label for="Sabah">Sabah</label>
                  <input type="checkbox" name="location" id="Sabah" value="Sabah">
                </div>

                <div class="location">
                  <label for="Sarawak">Sarawak</label>
                  <input type="checkbox" name="location" id="Sarawak" value="Sarawak">
                </div>

                <div class="location">
                  <label for="Terengganu">Terengganu</label>
                  <input type="checkbox" name="location" id="Terengganu" value="Terengganu">
                </div>
                <div class="location">
                  <label for="n9">Negeri Sembilan</label>
                  <input type="checkbox" name="location" id="n9" value="n9">
                </div>
                <div class="location">
                  <label for="pahang">Pahang</label>
                  <input type="checkbox" name="location" id="pahang" value="pahang">
                </div>
                <div class="location">
                  <label for="perlis">Perlis</label>
                  <input type="checkbox" name="location" id="perlis" value="perlis">
                </div>
                <div class="location">
                  <label for="Kuala Lumpur">Kuala Lumpur</label>
                  <input type="checkbox" name="location" id="Kuala Lumpur" value="Kuala Lumpur">
                </div>
                <div class="location">
                  <label for="Putrajaya">Putrajaya</label>
                  <input type="checkbox" name="location" id="Putrajaya" value="Putrajaya">
                </div>
                <div class="location">
                  <label for="Labuan">Labuan</label>
                  <input type="checkbox" name="location" id="Labuan" value="Labuan">
                </div>
                <div class="location">
                  <label for="Cyberjaya">Cyberjaya</label>
                  <input type="checkbox" name="location" id="Cyberjaya" value="Cyberjaya">
                </div>
              </div>
            </div>
            <input type="submit" value="submit" class="submit_button">
          </div>
        </form>
      </div>
    </div>
  </div>
  <script src="onePageScript.js"></script>
  <!-- firebase sdk -->
  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-app.js"></script>

  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-analytics.js"></script>

  <script src="https://www.gstatic.com/firebasejs/7.14.1/firebase-database.js"></script>

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyAdzeQLDkgbKMSS72UctU4qpy1aNvdXVmY",
      authDomain: "unisearch-a99d0.firebaseapp.com",
      databaseURL: "https://unisearch-a99d0.firebaseio.com",
      projectId: "unisearch-a99d0",
      storageBucket: "unisearch-a99d0.appspot.com",
      messagingSenderId: "1039068882718",
      appId: "1:1039068882718:web:03e77aac307f69af244b0f",
      measurementId: "G-5GJNV3VW5W"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    console.log("before analytics");
    firebase.analytics();

    console.log("after analytics");

    var database = firebase.database();
    //initialise required variable
    let category2course = new Map();

    //start getting all data and build local database
    firebase.database().ref('/category').once('value').then(function (snapshot) {
      const snap = snapshot.val();

      //initialise all entry
      for (let i = 0; i < 213; i++) {
        // console.log(snap[i]);
        //if the name of catoegory is not in category2course
        if (!category2course.has(snap[i][0])) {
          let course2obj = new Map();
          //this Map map index to course, just for reference
          let courseIndex = new Map();
          //make Uniblock object
          const obj = {
            // course:snap[i][1],
            min_cgpa: snap[i][2],
            min_muet: snap[i][3],
            location: snap[i][4],
            uni_index: snap[i][5]
          }
          // console.log("size of map category2course is " + category2course.size);
          //the size + 1
          courseIndex.set(courseIndex.size, obj);
          course2obj.set(snap[i][1], courseIndex);
          category2course.set(snap[i][0], course2obj);
        } else {
          //category exist but the course is not in that category
          if (!category2course.get(snap[i][0]).has(snap[i][1])) {
            // console.log("category exist but the course is not in that category");
            const obj = {
              // course:snap[i][1],
              min_cgpa: snap[i][2],
              min_muet: snap[i][3],
              location: snap[i][4],
              uni_index: snap[i][5]
            }
            let courseIndex = new Map();
            courseIndex.set(courseIndex.size, obj);
            category2course.get(snap[i][0]).set(snap[i][1], courseIndex);
          } else {
            // console.log("new obj!");
            const obj = {
              // course:snap[i][1],
              min_cgpa: snap[i][2],
              min_muet: snap[i][3],
              location: snap[i][4],
              uni_index: snap[i][5]
            }
            const size2 = category2course.get(snap[i][0]).get(snap[i][1]).size;
            // console.log(size2);
            category2course.get(snap[i][0]).get(snap[i][1]).set(size2, obj);
          }
        }
      }
      //set available category in input field
      let newInnerHTML = ``;
      for (let temp of category2course.keys()) {
        newInnerHTML += `<option value="` + temp + `"></option>`;
      }
      document.getElementById("categoriesList").innerHTML = newInnerHTML;
    });
  </script>
</body>

</html>